# -*- coding: utf-8 -*-
"""Flight delay Prediction

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1_i5Ew8U5Y_WqhOY200JVzNhO_qAHJj9D
"""

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import numpy as np
from sklearn.model_selection import train_test_split

df = pd.read_csv('flights.csv',low_memory=False)
df2 = df.head(100000)
df2.head()

df2['DIVERTED'].value_counts()

plt.figure(figsize = (20,10))
sns.heatmap (df2.corr(),annot=True,cmap='PuBuGn',fmt='g')
plt.show()
cols = ['YEAR','FLIGHT_NUMBER','AIRLINE','DISTANCE','TAIL_NUMBER','TAXI_OUT','SCHEDULED_TIME','DEPARTURE_TIME','WHEELS_OFF','WHEELS_ON','ELAPSED_TIME','AIR_TIME','DAY_OF_WEEK','TAXI_IN','ARRIVAL_TIME','CANCELLATION_REASON']

df = df2.drop(columns=cols,axis = 1)

df = df.fillna(df.mean())

df['result']= df.apply(lambda df:1 if df['ARRIVAL_DELAY']>15 else 0, axis=1)

df['result'].value_counts()

X = df[['MONTH','DAY','SCHEDULED_DEPARTURE','DEPARTURE_DELAY','SCHEDULED_ARRIVAL','DIVERTED','CANCELLED','AIR_SYSTEM_DELAY','SECURITY_DELAY','AIRLINE_DELAY','LATE_AIRCRAFT_DELAY','WEATHER_DELAY']]

Y = df['result']

x_train, x_test, y_train, y_test = train_test_split(
    X, Y, test_size=0.30, random_state=42)

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
x_train = scaler.fit_transform(x_train)
x_test = scaler.transform(x_test)

from sklearn.tree import DecisionTreeClassifier

clf = DecisionTreeClassifier()
clf= clf.fit(x_train,y_train)

y_score = clf.predict(x_test)

from sklearn.metrics import roc_auc_score

print(roc_auc_score(y_score,y_test))

